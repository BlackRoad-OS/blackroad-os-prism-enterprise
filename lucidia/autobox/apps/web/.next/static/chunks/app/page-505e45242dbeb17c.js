(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{1956:function(e,t,s){Promise.resolve().then(s.bind(s,6802))},6802:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return u}});var n=s(413),i=s(6060),a=s(690);a.Ry({id:a.Z_().min(1,"identity id is required"),publicKey:a.Z_().min(1,"public key is required"),settings:a.IM(a.Yj()).default({}).describe("user-controlled configuration for consent and crypto toggles")}),a.Ry({id:a.Z_().min(1),ownerId:a.Z_().min(1),title:a.Z_().min(1),description:a.Z_().optional(),createdAt:a.hT()}),a.Ry({id:a.Z_().min(1),ownerId:a.Z_().min(1),rawText:a.Z_().min(1),createdAt:a.hT()}),a.Ry({id:a.Z_().min(1),itemId:a.Z_().min(1),boxId:a.Z_().min(1),score:a.Rx().min(0).max(1).describe("confidence score normalised between 0 and 1"),rationale:a.Z_().min(1,"rationale is required").describe("short explanation for why an item belongs in the box"),createdAt:a.hT()}),a.Ry({id:a.Z_().min(1),ownerId:a.Z_().min(1),purpose:a.Z_().min(1),scope:a.IX(a.Z_()).default([]),createdAt:a.hT(),expiresAt:a.hT().nullable()});let l=a.Ry({boxTitle:a.Z_().min(1),tags:a.IX(a.Z_()).default([]),score:a.Rx().min(0).max(1),rationale:a.Z_().min(1)});function o(e){let{suggestions:t,onToggle:s,onTitleChange:a}=e,[l,o]=(0,i.useState)({});return 0===t.length?(0,n.jsx)("p",{className:"muted",children:"No suggestions yet. Paste notes above and request a preview."}):(0,n.jsx)("ul",{className:"suggestion-list",children:t.map(e=>{var t;let i=null!==(t=l[e.id])&&void 0!==t&&t;return(0,n.jsxs)("li",{className:"suggestion-card",children:[(0,n.jsxs)("div",{className:"suggestion-header",children:[(0,n.jsxs)("label",{className:"checkbox-label",children:[(0,n.jsx)("input",{type:"checkbox",checked:e.enabled,onChange:t=>s(e.id,t.target.checked)}),"Enable"]}),(0,n.jsxs)("span",{children:["Confidence: ",(100*e.score).toFixed(0),"%"]})]}),(0,n.jsxs)("div",{className:"suggestion-body",children:[(0,n.jsx)("input",{className:"suggestion-title",value:e.boxTitle,onChange:t=>a(e.id,t.target.value),"aria-label":"Box title"}),(0,n.jsx)("div",{className:"tag-row",children:e.tags.map(e=>(0,n.jsx)("span",{className:"tag",children:e},e))}),(0,n.jsx)("button",{type:"button",className:"link-button",onClick:()=>o(t=>({...t,[e.id]:!i})),children:i?"Hide why":"Why?"}),i?(0,n.jsxs)("div",{className:"explain-panel",children:[(0,n.jsx)("p",{children:e.rationale}),(0,n.jsxs)("p",{className:"muted",style:{marginTop:"8px",fontSize:"0.75rem"},children:["Minimal features: ",e.minimalFeatures.join(", ")||"n/a"]})]}):null]})]},e.id)})})}async function r(e){let t=await fetch("".concat("http://localhost:4000","/classify"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...e,maxSuggestions:4})});if(!t.ok){var s;throw Error(null!==(s=(await t.json().catch(()=>({message:t.statusText}))).message)&&void 0!==s?s:"Failed to request preview")}return await t.json()}a.Ry({previewId:a.Z_().min(1),suggestions:a.IX(l),processedCharacters:a.Rx().int().min(0)}),a.Ry({id:a.Z_().min(1),ownerId:a.Z_().min(1),action:a.Z_().min(1),createdAt:a.hT(),context:a.IM(a.Yj()).default({})}),a.Ry({previewId:a.Z_().min(1),itemText:a.Z_().min(1),suggestion:l,minimalFeatures:a.IX(a.Z_())}),a.Ry({categories:a.IX(a.Z_()),expiresAt:a.hT().nullable()});let c={id:"demo-user",publicKey:"demo-public-key",settings:{}};function d(e,t,s){let n=new Blob([t],{type:s}),i=URL.createObjectURL(n),a=document.createElement("a");a.href=i,a.download=e,a.click(),URL.revokeObjectURL(i)}function u(){let[e,t]=(0,i.useState)(""),[s,a]=(0,i.useState)("lucidia"),[l,u]=(0,i.useState)(!1),[m,h]=(0,i.useState)(!1),[p,x]=(0,i.useState)(null),[g,b]=(0,i.useState)(null),[y,j]=(0,i.useState)([]),[v,f]=(0,i.useState)({boxes:[],assignments:[],items:[]}),[N,w]=(0,i.useState)(null);(0,i.useEffect)(()=>{if(null===N||N<=0)return;let e=window.setTimeout(()=>{w(e=>null!==e?e-1:null)},1e3);return()=>window.clearTimeout(e)},[N]);let k=(0,i.useMemo)(()=>g?new Map(g.explainability.map(e=>[e.suggestion.rationale,e])):new Map,[g]),_=async()=>{if(!l){x("Consent is required before requesting a preview.");return}if(!e.trim()){x("Paste some text to classify.");return}h(!0),x(null);try{let t=await r({text:e,seed:s,consentToken:"consent-".concat(c.id)});b(t),j(t.preview.suggestions.map(e=>{var s,n;return{id:"".concat(e.boxTitle).concat(e.rationale),boxTitle:e.boxTitle,rationale:e.rationale,tags:e.tags,score:e.score,minimalFeatures:null!==(n=null===(s=t.explainability.find(t=>t.suggestion.boxTitle===e.boxTitle&&t.suggestion.rationale===e.rationale))||void 0===s?void 0:s.minimalFeatures)&&void 0!==n?n:[],enabled:!0}}))}catch(e){x(e instanceof Error?e.message:"Failed to request preview")}finally{h(!1)}};return(0,n.jsxs)("div",{className:"page",children:[(0,n.jsxs)("header",{className:"page-header",children:[(0,n.jsx)("h1",{className:"title-main",children:"Auto-Box Preview"}),(0,n.jsx)("p",{className:"muted",children:"Lucidia keeps your words yours. Paste notes, opt-in to processing, and inspect every suggestion before saving."})]}),(0,n.jsxs)("section",{className:"section stack",children:[(0,n.jsx)("label",{className:"label",htmlFor:"notes",children:"Paste your notes"}),(0,n.jsx)("textarea",{id:"notes",className:"textarea",value:e,onChange:e=>t(e.target.value),placeholder:"Drop meeting scribbles or research fragments here..."}),(0,n.jsxs)("div",{className:"row",children:[(0,n.jsxs)("label",{className:"checkbox-label",children:[(0,n.jsx)("input",{type:"checkbox",checked:l,onChange:e=>u(e.target.checked)}),"I consent to one-time processing of this text"]}),(0,n.jsxs)("label",{className:"row",style:{gap:"8px"},children:[(0,n.jsx)("span",{className:"hint",children:"Seed"}),(0,n.jsx)("input",{className:"input-inline",value:s,onChange:e=>a(e.target.value),"aria-label":"Deterministic seed"})]})]}),(0,n.jsx)("button",{type:"button",className:"button-primary",onClick:_,disabled:m||!l||!e.trim(),children:m?"Generating preview…":"Preview assignments"}),p?(0,n.jsx)("p",{className:"hint",style:{color:"var(--red-300)"},children:p}):null]}),(0,n.jsxs)("section",{className:"section stack",children:[(0,n.jsx)("h2",{className:"section-title",children:"Suggested boxes"}),(0,n.jsx)(o,{suggestions:y,onToggle:(e,t)=>j(s=>s.map(s=>s.id===e?{...s,enabled:t}:s)),onTitleChange:(e,t)=>j(s=>s.map(s=>s.id===e?{...s,boxTitle:t}:s))}),(0,n.jsx)("button",{type:"button",className:"button-secondary",onClick:()=>{if(!g||y.every(e=>!e.enabled))return;let t=crypto.randomUUID(),s=new Date,n=y.filter(e=>e.enabled),i=n.map(e=>({id:crypto.randomUUID(),ownerId:c.id,title:e.boxTitle,description:e.rationale,createdAt:s})),a=n.map((e,n)=>({id:crypto.randomUUID(),itemId:t,boxId:i[n].id,score:e.score,rationale:e.rationale,createdAt:s})),l={id:t,ownerId:c.id,rawText:e,createdAt:s};f(e=>({boxes:[...e.boxes,...i],assignments:[...e.assignments,...a],items:[...e.items,l]}))},disabled:y.every(e=>!e.enabled),children:"Save selected boxes"})]}),(0,n.jsxs)("section",{className:"section stack",children:[(0,n.jsx)("h2",{className:"section-title",children:"Saved preview"}),0===v.assignments.length?(0,n.jsx)("p",{className:"muted",children:"Nothing saved yet. Saved boxes will appear here with explain links ready for auditing."}):(0,n.jsx)("ul",{className:"saved-list",children:v.assignments.map(e=>{var t;let s=v.boxes.find(t=>t.id===e.boxId);return(0,n.jsxs)("li",{className:"saved-card",children:[(0,n.jsxs)("div",{className:"saved-card-header",children:[(0,n.jsx)("span",{className:"saved-title",children:null!==(t=null==s?void 0:s.title)&&void 0!==t?t:"Box"}),(0,n.jsx)("button",{type:"button",className:"link-button",onClick:()=>{let t=k.get(e.rationale);t&&alert("".concat(t.suggestion.rationale,"\n\nMinimal features: ").concat(t.minimalFeatures.join(", ")))},children:"Why?"})]}),(0,n.jsxs)("p",{className:"hint",children:["Score: ",(100*e.score).toFixed(0),"%"]})]},e.id)})}),(0,n.jsxs)("div",{className:"actions-row",children:[(0,n.jsx)("button",{type:"button",className:"button-outline",onClick:()=>{var e;0!==v.assignments.length&&d("lucidia-autobox-export.json",JSON.stringify({identity:(e={identity:c,boxes:v.boxes,assignments:v.assignments,items:v.items}).identity,boxes:e.boxes,items:e.items,assignments:e.assignments,exportedAt:new Date().toISOString(),codex:"1 — The First Principle"},null,2),"application/json")},disabled:0===v.assignments.length,children:"Export JSON"}),(0,n.jsx)("button",{type:"button",className:"button-outline",onClick:()=>{0!==v.assignments.length&&d("lucidia-autobox-export.md",function(e){let t=[];return t.push("# Lucidia Export"),t.push("Exported: ".concat(new Date().toISOString())),t.push(""),t.push("## Identity"),t.push("- id: ".concat(e.identity.id)),t.push("- publicKey: ".concat(e.identity.publicKey)),t.push(""),t.push("## Boxes"),e.boxes.forEach(e=>{t.push("- **".concat(e.title,"** (created ").concat(e.createdAt.toISOString(),")")),e.description&&t.push("  - ".concat(e.description))}),t.push(""),t.push("## Assignments"),e.assignments.forEach(e=>{t.push("- Item ".concat(e.itemId," → Box ").concat(e.boxId)),t.push("  - Score: ".concat(e.score)),t.push("  - Rationale: ".concat(e.rationale))}),t.push(""),t.push("## Items"),e.items.forEach(e=>{t.push("### Item ".concat(e.id)),t.push("```"),t.push(e.rawText),t.push("```")}),t.join("\n")}({identity:c,boxes:v.boxes,assignments:v.assignments,items:v.items}),"text/markdown")},disabled:0===v.assignments.length,children:"Export Markdown"}),(0,n.jsx)("button",{type:"button",className:"button-outline-danger",onClick:()=>{if(0!==v.assignments.length){if(null===N){w(10);return}N>0||(f({boxes:[],assignments:[],items:[]}),w(null))}},disabled:0===v.assignments.length,children:null===N?"Delete all (10s hold)":N>0?"Confirming… ".concat(N,"s"):"Click to wipe everything"}),null!==N?(0,n.jsx)("button",{type:"button",className:"button-outline",onClick:()=>{w(null)},children:"Cancel"}):null]})]})]})}}},function(e){e.O(0,[690,462,816,744],function(){return e(e.s=1956)}),_N_E=e.O()}]);